(()=>{"use strict";var e={n:s=>{var r=s&&s.__esModule?()=>s.default:()=>s;return e.d(r,{a:r}),r},d:(s,r)=>{for(var t in r)e.o(r,t)&&!e.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:r[t]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.element,r=window.wp.apiFetch;var t=e.n(r);const a=window.ReactJSXRuntime;function l({query:e,includeAnalyze:s,loading:r,onQueryChange:t,onAnalyzeChange:l,onSubmit:n,onClear:d}){return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n()},className:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"sql-query",className:"block text-sm font-medium text-gray-700 mb-2",children:"SQL Query"}),(0,a.jsx)("textarea",{id:"sql-query",value:e,onChange:e=>t(e.currentTarget.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&n()},placeholder:"Enter your SQL query here... (Ctrl+Enter to submit)",className:"w-full h-40 px-3 py-2 border border-gray-300 rounded-md font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",disabled:r})]}),(0,a.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,a.jsx)("input",{id:"include-analyze",type:"checkbox",checked:s,onChange:e=>l(e.currentTarget.checked),disabled:r,className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"}),(0,a.jsx)("label",{htmlFor:"include-analyze",className:"ml-2 text-sm text-gray-700 cursor-pointer",children:"Include ANALYZE results"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:r||!e.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:r?"Analyzing...":"Analyze Query"}),(0,a.jsx)("button",{type:"button",onClick:d,disabled:r||!e.trim(),className:"px-6 py-2 bg-gray-300 text-gray-700 rounded-md font-medium hover:bg-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Clear"})]})]})}function n({type:e,title:s,message:r,onDismiss:t}){const l="error"===e,n=l?"bg-red-50":"bg-green-50",d=l?"border-red-200":"border-green-200",o=l?"text-red-900":"text-green-900",i=l?"text-red-700":"text-green-700",c=l?"hover:bg-red-100":"hover:bg-green-100";return(0,a.jsx)("div",{className:`${n} ${d} ${o} px-4 py-4 rounded-md border mb-4`,role:"alert",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:`${i} font-medium mb-1`,children:s}),(0,a.jsx)("p",{className:"text-sm",children:r})]}),t&&(0,a.jsx)("button",{onClick:t,className:`${c} ml-2 p-1 rounded transition-colors`,"aria-label":"Dismiss",children:(0,a.jsx)("span",{className:"text-lg leading-none",children:"Ã—"})})]})})}function d({content:e,label:r="Copy"}){const[t,l]=(0,s.useState)(!1);return(0,a.jsx)("button",{onClick:async()=>{try{await navigator.clipboard.writeText(e),l(!0),setTimeout(()=>l(!1),2e3)}catch{console.error("Failed to copy to clipboard")}},className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:(0,a.jsx)("span",{children:t?"Copied!":r})})}function o({response:e}){if(!e.data)return null;const{data:s}=e,r=s.complete_output;return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"SQL Query Analysis Report"})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"mb-4 flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Original Query"}),(0,a.jsx)("pre",{className:"bg-gray-50 border border-gray-200 rounded p-3 text-sm font-mono text-gray-800 overflow-x-auto max-h-32",children:s.query})]})}),(0,a.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Complete Analysis Output"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("pre",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-xs font-mono text-gray-700 overflow-x-auto max-h-96 whitespace-pre-wrap break-words",children:r})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(d,{content:r,label:"Copy Output"})})]}),s.tables.length>0&&(0,a.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Table Structures"}),(0,a.jsx)("div",{className:"space-y-4",children:s.tables.map(e=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded p-4 border border-gray-200",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 mb-3",children:e.name}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-300 bg-white",children:[(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Column"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Type"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Null"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Key"})]})}),(0,a.jsx)("tbody",{children:e.columns.map((e,s)=>(0,a.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-100",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-mono text-gray-900",children:e.name}),(0,a.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.type}),(0,a.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.null?"YES":"NO"}),(0,a.jsx)("td",{className:"px-3 py-2 font-mono text-blue-600",children:e.key||"-"})]},s))})]})})]},e.name))})]}),Object.keys(s.indexes).length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Indexes"}),(0,a.jsx)("div",{className:"space-y-4",children:Object.entries(s.indexes).map(([e,s])=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded p-4 border border-gray-200",children:[(0,a.jsx)("h5",{className:"font-medium text-gray-900 mb-3",children:e}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-300 bg-white",children:[(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Index"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Type"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Column"}),(0,a.jsx)("th",{className:"text-left px-3 py-2 font-medium text-gray-700",children:"Unique"})]})}),(0,a.jsx)("tbody",{children:s.map((e,s)=>(0,a.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-100",children:[(0,a.jsx)("td",{className:"px-3 py-2 font-mono text-gray-900",children:e.name}),(0,a.jsx)("td",{className:"px-3 py-2 text-gray-700",children:e.type}),(0,a.jsx)("td",{className:"px-3 py-2 font-mono text-gray-700",children:e.column}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium "+(e.unique?"bg-green-100 text-green-800":"bg-gray-200 text-gray-800"),children:e.unique?"Yes":"No"})})]},s))})]})})]},e))})]})]})]})}function i(){return(0,a.jsx)("div",{className:"flex items-center justify-center h-full min-h-[400px] bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:(0,a.jsxs)("div",{className:"text-center max-w-sm",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Analysis Yet"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:'Enter a SQL query on the left and click "Analyze Query" to see results here.'}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:(0,a.jsxs)("p",{className:"text-xs text-blue-800",children:["ðŸ’¡ ",(0,a.jsx)("strong",{children:"Tip:"})," Use SELECT queries only. The analyzer will show you execution plans, table structures, and index information."]})})]})})}function c({loading:e,error:r,response:t,onDismissError:l}){return(0,a.jsxs)("div",{className:"space-y-4 h-full",children:[e&&(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg border border-gray-200 text-center",children:(0,a.jsxs)("div",{className:"inline-flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin h-5 w-5 mr-3 border-2 border-blue-600 border-t-transparent rounded-full"}),(0,a.jsx)("span",{className:"text-gray-700",children:"Analyzing query..."})]})}),r&&(0,a.jsx)(n,{type:"error",title:"Error",message:r,onDismiss:l}),t&&!r&&(0,a.jsxs)(s.Fragment,{children:[t.success?(0,a.jsx)(n,{type:"success",title:"Success",message:t.message}):(0,a.jsx)(n,{type:"error",title:"Error",message:t.message,onDismiss:l}),t.data&&(0,a.jsx)(o,{response:t})]}),!e&&!r&&!t&&(0,a.jsx)(i,{})]})}const m=()=>{const[e,r]=(0,s.useState)(""),[n,d]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),y=(0,s.useCallback)(async()=>{if(e.trim()){i(!0),x(null),h(null);try{const s=await t()({path:"/sql-analyzer/v1/analyze",method:"POST",data:{query:e.trim(),include_analyze:n}});h(s),s.success||x(s.message)}catch(e){const s=e instanceof Error?e.message:"An error occurred while analyzing the query";x(s)}finally{i(!1)}}else x("Please enter a SQL query")},[e,n]),b=(0,s.useCallback)(()=>{r(""),d(!1),x(null),h(null)},[]),g=(0,s.useCallback)(()=>{x(null)},[]);return(0,a.jsx)("div",{className:"sql-analyzer-app bg-gray-100 min-h-screen py-8 px-4",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"SQL Analyzer"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Analyze your SQL queries with detailed EXPLAIN results and database structure information"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[45%_55%] gap-6",children:[(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)(l,{query:e,includeAnalyze:n,loading:o,onQueryChange:r,onAnalyzeChange:d,onSubmit:y,onClear:b})}),(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)(c,{loading:o,error:m,response:u,onDismissError:g})})]})]})})};(0,s.createRoot)(document.getElementById("dashboard")).render((0,a.jsx)(m,{}))})();